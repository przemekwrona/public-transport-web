openapi: 3.0.0
info:

paths:
  /agency/{agency}/timetable-generator:
    get:
      tags:
        - timetable-generator
      summary: Get list all generated timetables
      operationId: findAll
      parameters:
        - in: path
          name: agency
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimetableGeneratorFindAllResponse'

    post:
      tags:
        - timetable-generator
      summary: Create new timetable generator
      operationId: createTimetableGenerator
      parameters:
        - in: path
          name: agency
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTimetableGeneratorRequest'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateTimetableGeneratorRequest'

    put:
      tags:
        - timetable-generator
      summary: Update already existed timetable
      parameters:
        - in: path
          name: agency
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:

    delete:
      tags:
        - timetable-generator
      summary: Delete generated summary
      operationId: deleteTimetableGenerator
      parameters:
        - in: path
          name: agency
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TimetableGeneratorDeletionRequest'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '../public-transport-api.yaml/#/components/schemas/Status'

  /agency/{agency}/timetable-generator/routes:
    get:
      tags:
        - timetable-generator
      summary: Get list all generated timetables
      operationId: findRoutes
      parameters:
        - in: path
          name: agency
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimetableGeneratorFilterByRoutesResponse'

  /agency/{agency}/timetable-generator/trips:
    post:
      tags:
        - timetable-generator
      summary: Get front and back trips
      operationId: findTrips
      parameters:
        - in: path
          name: agency
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TripFilter'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'


  /agency/{agency}/timetable-generator/calendars:
    get:
      tags:
        - timetable-generator
      summary: Get list all generated timetables
      operationId: findCalendars
      parameters:
        - in: path
          name: agency
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimetablePayload'

components:
  schemas:

    TripFilter:
      type: object
      properties:
        routeId:
          $ref: '../public-transport-api.yaml/#/components/schemas/RouteId'

    TimetableTrip:
      type: object
      properties:
        tripId:
          $ref: '../public-transport-api.yaml/#/components/schemas/TripId'
        designation:
          type: string
        description:
          type: string

    TripDepartures:
      type: object
      properties:
        tripId:
          $ref: '../public-transport-api.yaml/#/components/schemas/TripId'
        departures:
          type: array
          items:
            $ref: '#/components/schemas/TimetableTrip'

    TripResponse:
      type: object
      properties:
        routeFilter:
          $ref: '../public-transport-api.yaml/#/components/schemas/RouteId'
        front:
          $ref: '#/components/schemas/TripDepartures'
        back:
          $ref: '#/components/schemas/TripDepartures'

    TimetableStopTime:
      type: object
      properties:
        time:
          type: string
        designation:
          type: string

    TimetablePayload:
      type: object
      properties:
        startDate:
          type: string
        endDate:
          type: string
        interval:
          type: integer
        departures:
          type: array
          items:
            $ref: '#/components/schemas/TimetableStopTime'

    TimetableGeneratorPayload:
      type: object
      properties:
        calendarName:
          type: string
        front:
          $ref: '#/components/schemas/TimetablePayload'
        back:
          $ref: '#/components/schemas/TimetablePayload'

    CreateTimetableGeneratorRequest:
      type: object
      properties:
        routeId:
          $ref: '../public-transport-api.yaml/#/components/schemas/RouteId'
        timetables:
          $ref: '#/components/schemas/TimetableGeneratorPayload'

    TimetableGeneratorFilterByRoutes:
      type: object
      properties:
        routeId:
          $ref: '../public-transport-api.yaml/#/components/schemas/RouteId'
        hasMainFrontVariant:
          type: boolean
        hasMainBackVariant:
          type: boolean

    TimetableGeneratorFilterByRoutesResponse:
      type: object
      properties:
        page:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/TimetableGeneratorFilterByRoutes'

    TimetableGeneratorFilterByCalendar:
      type: object
      properties:

    TimetableGeneratorCalendar:
      type: object
      properties:
        designation:
          type: string
        description:
          type: string

    TimetableGeneratorFindAllItem:
      type: object
      properties:
        routeLine:
          type: string
        routeName:
          type: string
        routeVersion:
          type: integer
        calendarNames:
          type: array
          items:
            $ref: '#/components/schemas/TimetableGeneratorCalendar'
        createdAt:
          type: string
          format: date-time

    TimetableGeneratorFindAllResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TimetableGeneratorFindAllItem'

    TimetableGeneratorDeletionRequest:
      type: object
      properties:
        routeId:
          $ref: '../public-transport-api.yaml/#/components/schemas/RouteId'
        createdDate:
          type: string
          format: date-time

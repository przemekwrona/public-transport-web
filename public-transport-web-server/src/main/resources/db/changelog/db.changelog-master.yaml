databaseChangeLog:
  - changeSet:
      id: create-table-bus-stops
      author: pwrona
      changes:
        - createTable:
            tableName: stop
            columns:
              - column:
                  name: osm_id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: varchar(150)
                  constraints:
                    nullable: true
              - column:
                  name: ref
                  type: varchar(150)
              - column:
                  name: lon
                  type: float
              - column:
                  name: lat
                  type: float

        - createSequence:
            sequenceName: stop_id_seq
            startValue: 1
            incrementBy: 1

#  - changeSet:
#      id: insert-bus-stops
#      author: pwrona
#      context: dev
#      changes:
#        - sqlFile:
#            path: pl_bus_stops.sql

  - changeSet:
      id: create-basic-model
      author: pwrona
      changes:
        - createTable:
            tableName: agency
            columns:
              - column:
                  name: agency_id
                  type: integer
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: agency_code
                  type: varchar(10)
                  constraints:
                    nullable: false
                    unique: true

        - createTable:
            tableName: route
            columns:
              - column:
                  name: agency_code
                  type: varchar(10)
                  constraints:
                    primaryKey: true
                    primaryKeyName: pk_route
                    foreignKeyName: fk_route_agency
                    references: agency(agency_code)
              - column:
                  name: route_id
                  type: varchar(30)
                  constraints:
                    primaryKey: true
                    nullable: false

        - createTable:
            tableName: trip
            columns:
              - column:
                  name: agency_code
                  type: varchar(10)
                  constraints:
                    primaryKey: true
                    primaryKeyName: pk_trip
              - column:
                  name: trip_id
                  type: varchar(30)
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: route_id
                  type: varchar(30)
                  constraints:
                    nullable: false

        - addForeignKeyConstraint:
            baseTableName: trip
            baseColumnNames: agency_code,route_id
            referencedTableName: route
            referencedColumnNames: agency_code,route_id
            constraintName: fk_trip_route

        - createTable:
            tableName: stop_time
            columns:
              - column:
                  name: agency_code
                  type: varchar(10)
                  constraints:
                    nullable: false
              - column:
                  name: trip_id
                  type: varchar(30)
                  constraints:
                    nullable: false
              - column:
                  name: arrival_time
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: departure_time
                  type: varchar(8)
                  constraints:
                    nullable: false
              - column:
                  name: stop_id
                  type: int
                  constraints:
                    nullable: false
                    foreignKeyName: fk_stop_time_stop
                    references: stop(osm_id)
              - column:
                  name: stop_sequence
                  type: int
                  constraints:
                    nullable: false

        - addForeignKeyConstraint:
            baseTableName: stop_time
            baseColumnNames: agency_code,trip_id
            referencedTableName: trip
            referencedColumnNames: agency_code,trip_id
            constraintName: fk_stop_time_trip
